<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cliffs, Craic & Carbs | Ireland 2026</title>
    
    <!-- External Dependencies -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;600;800&family=Crimson+Pro:ital,wght@0,600;1,400&display=swap');
        
        body { font-family: 'Outfit', sans-serif; background-color: #fcfcf9; color: #1e293b; -webkit-tap-highlight-color: transparent; }
        .serif { font-family: 'Crimson Pro', serif; }
        
        #map { height: 450px; width: 100%; border-radius: 2rem; border: 4px solid white; box-shadow: 0 20px 25px -5px rgba(0,0,0,0.1); z-index: 1; }
        .glass-nav { background: rgba(255, 255, 255, 0.85); backdrop-filter: blur(12px); border-bottom: 1px solid rgba(0,0,0,0.05); }
        .blog-card { transition: all 0.3s ease; cursor: pointer; border: 1px solid rgba(0,0,0,0.05); }
        .blog-card:hover { transform: translateY(-5px); box-shadow: 0 20px 25px -5px rgba(0,0,0,0.1); }
        
        .reddit-quote { border-left: 4px solid #ff4500; background: #fff5f2; padding: 1.5rem; border-radius: 0 1.5rem 1.5rem 0; color: #431407; }
        
        .prose-analysis p { margin-bottom: 1.5rem; line-height: 1.8; color: #334155; }
        .prose-analysis h3 { font-size: 1.75rem; font-weight: 800; color: #0f172a; margin-top: 3.5rem; margin-bottom: 1.25rem; border-left: 4px solid #10b981; padding-left: 1.25rem; }
        .prose-analysis h4 { font-size: 1.3rem; font-weight: 700; color: #1e293b; margin-top: 2rem; margin-bottom: 1rem; }

        .research-pill { background: #f1f5f9; border-radius: 1.25rem; padding: 1.5rem; border: 1px solid #e2e8f0; height: 100%; }
        
        /* HARD OVERWRITES FOR CONTRAST - Pure White */
        #rv-header { color: #ffffff !important; font-weight: 900; }
        #rv-stats { color: #ffffff !important; font-weight: 900; }
        #rv-protocol-label { color: #ffffff !important; font-weight: 900; }
        
        .fade-in { animation: fadeIn 0.4s ease-out forwards; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        .no-scrollbar::-webkit-scrollbar { display: none; }
        
        @media (max-width: 768px) {
            .detail-header { height: 50vh !important; }
            .hero-title { font-size: 2.75rem !important; line-height: 1.1 !important; }
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel" data-type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously, signInWithCustomToken, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, doc, setDoc, updateDoc, onSnapshot, arrayUnion, getDoc } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        const { useState, useEffect, useRef } = React;

        // --- FINALIZED FIREBASE CONFIGURATION ---
        const personalFirebaseConfig = {
            apiKey: "AIzaSyD5zO2pFE_FrmyH_fQABmh8GcahM63XO1E",
            authDomain: "adventure-log-1b1a7.firebaseapp.com",
            projectId: "adventure-log-1b1a7",
            storageBucket: "adventure-log-1b1a7.firebasestorage.app",
            messagingSenderId: "553020659325",
            appId: "1:553020659325:web:718097613af26c9b6dc314",
            measurementId: "G-4FSVFMTFXN"
        };

        const configRaw = typeof window.__firebase_config !== 'undefined' ? window.__firebase_config : '{}';
        const envFirebaseConfig = typeof configRaw === 'string' ? JSON.parse(configRaw) : configRaw;
        
        const firebaseConfig = envFirebaseConfig.apiKey ? envFirebaseConfig : personalFirebaseConfig;
        const appId = typeof __app_id !== 'undefined' ? __app_id : 'cliffs-craic-carbs-vfinal';
        const initialToken = typeof __initial_auth_token !== 'undefined' ? __initial_auth_token : null;
        
        let db, auth;
        if (firebaseConfig.apiKey) {
            const app = initializeApp(firebaseConfig);
            auth = getAuth(app);
            db = getFirestore(app);
        }

        const ITINERARY_DATA = [
            { day: 1, date: "Mar 9", title: "Garden of Ireland", city: "Glendalough", img: "https://images.unsplash.com/photo-1590089415225-401ed6f9db8e?w=1200", coords: [53.0113, -6.3263], desc: "Monastic history and Hike 1: The Spinc (9.5km).", hike: "The Spinc White Route", hikeLink: "https://www.alltrails.com/trail/ireland/county-wicklow/the-spinc-and-glendalough-lake-white-route", reddit: "Reddit: 'Park in Laragh to save €5. The Upper Lake lot is often mobbed.'", hiddenBuilding: "St. Kevin's Kitchen", buildingDesc: "Rare stone-roofed 12th-century church.", hiddenShop: "Laragh Woollen Mills", shopDesc: "Authentic local blankets.", hiddenGem: "Reefert Church", gemDesc: "Medieval forest church burial site.", obscureFact: "St. Kevin prayed so still a bird nested in his hand.", cost: "Parking: €5; Entrance: Free" },
            { day: 2, date: "Mar 10", title: "The Rebel Food Capital", city: "Cork City", img: "https://images.unsplash.com/photo-1528493366314-e317cd98dd52?w=1200", coords: [51.8985, -8.4756], desc: "English Market and Glucksman gallery.", hike: "Blarney Castle Grounds: 5km Walk", hikeLink: "https://www.alltrails.com/trail/ireland/county-cork/blarney-castle-and-gardens", reddit: "Reddit: 'Miyazaki is the best Japanese food in Ireland. tiny spot, big flavors.'", hiddenBuilding: "Butter Exchange", buildingDesc: "Classic 18th-century trade center.", hiddenShop: "Mother Jones Flea", shopDesc: "Vintage warehouse hub.", hiddenGem: "Fitzgerald Park", gemDesc: "Riverside museum gardens.", obscureFact: "Cork streets were once open river channels.", cost: "Blarney: €18; Shandon: €5" },
            { day: 3, date: "Mar 11", title: "Kingdom's Biosphere", city: "Killarney", img: "https://res.cloudinary.com/djcyhbk2e/image/upload/c_scale,f_auto,q_35,w_1400/v1/gvv/prod/tjhmxbtwil5abuvwpftf", coords: [52.0599, -9.5044], desc: "UNESCO Biosphere and native Red Deer.", hike: "Torc Mountain Summit", hikeLink: "https://www.alltrails.com/trail/ireland/county-kerry/torc-mountain", reddit: "Reddit: 'Drive Ring of Kerry CLOCKWISE to avoid tour bus jams.'", hiddenBuilding: "Muckross Abbey", buildingDesc: "Friary with ancient yew.", hiddenShop: "Forest & Flock", shopDesc: "Contemporary Kerry craft.", hiddenGem: "Ladies View", gemDesc: "Victoria's favorite stop.", obscureFact: "The only native Red Deer herd in Ireland lives here.", cost: "Muckross: €9; Park: Free" },
            { day: 4, date: "Mar 12", title: "Gaelic Atlantic Edge", city: "Dingle", img: "https://images.ireland.com/thumbs/Images/Kerry/e5a32f6deb944b1dbf247d747bd744ad/smallhero-desktop.jpg", coords: [52.1409, -10.2707], desc: "Third-wave coffee and Mt. Brandon (952m).", hike: "Mount Brandon (Faha Route)", hikeLink: "https://www.alltrails.com/trail/ireland/county-kerry/mount-brandon-pilarims-path", reddit: "Reddit: 'Reel Dingle Fish has the best hake and chips.'", hiddenBuilding: "Gallarus Oratory", buildingDesc: "1,000-year-old mortarless church.", hiddenShop: "Louis Mulcahy Pottery", shopDesc: "Atlantic-inspired glazes.", hiddenGem: "Dingle Whiskey Bar", gemDesc: "Elite whiskey selection.", obscureFact: "50 pubs for only 2,000 residents.", cost: "Murphy's: €6; Huts: €3" },
            { day: 5, date: "Mar 13", title: "Vertical Frontier", city: "Cliffs of Moher", img: "https://images.unsplash.com/photo-1534067783941-51c9c23ecefd?w=1200", coords: [52.9719, -9.4265], desc: "214m sandstone cliffs and the Burren.", hike: "Moher Coastal Trail", hikeLink: "https://www.alltrails.com/trail/ireland/county-clare/cliffs-of-moher-coastal-trail--2", reddit: "Reddit: 'Park in Doolin and walk up to avoid visitor fees.'", hiddenBuilding: "O’Brien’s Tower", buildingDesc: "Victorian lookout folly.", hiddenShop: "Irish Crafts (Doolin)", shopDesc: "Fine linen and art.", hiddenGem: "Poulnabrone Dolmen", gemDesc: "Neolithic tomb in the Burren.", obscureFact: "Featured as 'Cliffs of Insanity' in Princess Bride.", cost: "Center: €10; Shuttle: €6" },
            { day: 6, date: "Mar 14", title: "Isolation of Stone", city: "Aran Islands", img: "https://images.ireland.com/media/Images/destinations/experiences/wild-atlantic-way/waw-supporting-images/WAW-places/4897b12d6a164f9eb4c2347b00372e88.jpg", coords: [53.1289, -9.7197], desc: "Ferry to Inis Mór and Iron Age stone forts.", hike: "Dún Aonghasa Fort Trek", hikeLink: "https://www.alltrails.com/trail/ireland/county-galway/dun-aonghasa-loop", reddit: "Reddit: 'Rent a bike in Kilronan early.'", hiddenBuilding: "Seven Churches", buildingDesc: "Ruins of monastic settlement.", hiddenShop: "Inis Meáin Knitting", shopDesc: "Luxury knitwear made on-island.", hiddenGem: "The Worm Hole", gemDesc: "Rectangular natural pool.", obscureFact: "Islanders created soil with seaweed and sand.", cost: "Ferry: €30; Bike: €15; Fort: €5" },
            { day: 7, date: "Mar 15", title: "Festival Hub Culture", city: "Dublin", img: "https://assets-eu-01.kc-usercontent.com/aa24ba70-9a12-01ae-259b-7ef588a0b2ef/5c5b9ae4-277e-4036-b4a3-12c203109e1a/gaia-illuminated-earth-artwork-on-display-in-the-old-library.jpg", coords: [53.3483, -6.2856], desc: "National Museum and Mother Pride Party.", hike: "Phoenix Park Loop", hikeLink: "https://www.alltrails.com/trail/ireland/county-dublin/phoenix-park-loop", reddit: "Reddit: 'Festival Quarter at Collins Barracks is the best hub.'", hiddenBuilding: "Collins Barracks", buildingDesc: "1702 military stronghold museum.", hiddenShop: "Industry & Co", shopDesc: "Lifestyle shop and deli.", hiddenGem: "Marsh’s Library", gemDesc: "Ireland’s oldest library (1701).", obscureFact: "Phoenix Park is the largest enclosed park in a European capital.", cost: "Museum: Free; Hub: Free" },
            { day: 8, date: "Mar 16", title: "Guinness Heritage", city: "Dublin", img: "https://images.unsplash.com/photo-1584916201218-f4242ceb4809?w=1200", coords: [53.3419, -6.2867], desc: "Taste Mór at the Storehouse.", hike: "Great South Wall Walk", hikeLink: "https://www.alltrails.com/trail/ireland/county-dublin/the-great-south-wall", reddit: "Reddit: 'Gravity Bar has the best view.'", hiddenBuilding: "St. Patrick's Cathedral", buildingDesc: "Largest church in Ireland, 5th-century site.", hiddenShop: "Gutter Bookshop", shopDesc: "Indie bookstore in Temple Bar West.", hiddenGem: "Iveagh Gardens", gemDesc: "Secret Victorian park.", obscureFact: "Guinness is ruby red, not black.", cost: "Storehouse Entry: €26" },
            { day: 9, date: "Mar 17", title: "National Day", city: "Dublin", img: "https://images.ireland.com/thumbs/Images/destinations/experiences/dublin/dublin-hero-final/9b2cee5ef7dd44a1b3e2611aca145ee5/featurecarousel-desktop.jpg", coords: [53.3498, -6.2603], desc: "The National Parade and evening Céilí Mór.", hike: "Parade Route Navigation", hikeLink: "#", reddit: "Reddit: 'Merrion Square is the best family hub.'", hiddenBuilding: "The GPO", buildingDesc: "1916 Rising headquarters.", hiddenShop: "Article (Powerscourt)", shopDesc: "Design-led homeware.", hiddenGem: "Moore Street Market", gemDesc: "The soul of traditional Dublin.", obscureFact: "Dublin's first parade was in 1931.", cost: "Parade: Free; Céilí: Free" },
            { day: 10, date: "Mar 18", title: "Departure & Recovery", city: "Dublin Airport", img: "https://images.ireland.com/media/Images/destinations/experiences/dublin/dublin-supporting-images/00a12990baab43b3a53ca9cec9345cba.jpg", coords: [53.4264, -6.2499], desc: "Recovery breakfast and US Pre-clearance.", hike: "Terminal Transit", hikeLink: "#", reddit: "Reddit: 'US Pre-clearance saves hours in US.'", hiddenBuilding: "Terminal 2", buildingDesc: "Ship-hull inspired architecture.", hiddenShop: "The Loop Whiskey", shopDesc: "Best place for limited Irish whiskeys.", hiddenGem: "Executive Lounge", gemDesc: "Quiet spot to board.", obscureFact: "First European country with US Pre-clearance.", cost: "Aircoach: €7; Breakfast: €15" }
        ];

        // --- SVG ICONS ---
        const Icon = ({ name, className = "" }) => {
            const icons = {
                MapPin: <svg className={`w-5 h-5 ${className}`} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"/><circle cx="12" cy="10" r="3"/></svg>,
                Calendar: <svg className={`w-5 h-5 ${className}`} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"/><line x1="16" y1="2" x2="16" y2="6"/><line x1="8" y1="2" x2="8" y2="6"/><line x1="3" y1="10" x2="21" y2="10"/></svg>,
                Car: <svg className={`w-5 h-5 ${className}`} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M19 17h2c.6 0 1-.4 1-1v-3c0-.9-.7-1.7-1.5-1.9C18.7 10.6 16 10 16 10s-1.3-1.4-2.2-2.3c-.5-.4-1.1-.7-1.8-.7H5c-.6 0-1.1.4-1.4.9l-1.4 2.9A3.7 3.7 0 0 0 2 12v4c0 .6.4 1 1 1h2"/><circle cx="7" cy="17" r="2"/><circle cx="17" cy="17" r="2"/></svg>,
                Wind: <svg className={`w-7 h-7 ${className}`} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M17.7 7.7a2.5 2.5 0 1 1 1.8 4.3H2"/><path d="M9.6 4.6A2 2 0 1 1 11 8H2"/><path d="M12.6 19.4A2 2 0 1 0 14 16H2"/></svg>,
                ArrowLeft: <svg className={`w-4 h-4 ${className}`} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="3"><line x1="19" y1="12" x2="5" y2="12"/><polyline points="12 19 5 12 12 5"/></svg>,
                Send: <svg className={`w-3 h-3 ${className}`} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="3"><line x1="22" y1="2" x2="11" y2="13"/><polygon points="22 2 15 22 11 13 2 9 22 2"/></svg>,
                Info: <svg className={`w-4 h-4 ${className}`} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><circle cx="12" cy="12" r="10"/><line x1="12" y1="16" x2="12" y2="12"/><line x1="12" y1="8" x2="12.01" y2="8"/></svg>,
                Zap: <svg className={`w-6 h-6 ${className}`} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2"/></svg>,
                Loader: <svg className={`w-4 h-4 animate-spin ${className}`} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="3"><path d="M21 12a9 9 0 1 1-6.219-8.56" /></svg>
            };
            return icons[name] || null;
        };

        const WeatherTile = ({ city, coords }) => {
            const [weather, setWeather] = useState(null);
            const [loading, setLoading] = useState(true);

            useEffect(() => {
                const fetchWeather = async () => {
                    try {
                        const res = await fetch(`https://api.open-meteo.com/v1/forecast?latitude=${coords[0]}&longitude=${coords[1]}&current_weather=true&temperature_unit=fahrenheit&windspeed_unit=mph`);
                        const data = await res.json();
                        setWeather(data.current_weather);
                    } catch (e) { console.error(e); }
                    setLoading(false);
                };
                fetchWeather();
            }, [coords]);

            if (loading) return <div className="p-4 bg-white/60 backdrop-blur rounded-2xl border border-slate-100 flex items-center justify-center animate-pulse"><p className="text-[10px] font-black uppercase text-slate-400 font-bold tracking-widest">Syncing Atmospheric Data...</p></div>;
            if (!weather) return null;

            return (
                <div className="bg-white border border-slate-200 p-5 rounded-[2rem] shadow-sm flex items-center gap-6 fade-in">
                    <div className="w-14 h-14 bg-emerald-50 rounded-2xl flex items-center justify-center text-3xl shadow-inner">⛅</div>
                    <div>
                        <p className="text-[10px] font-black uppercase text-emerald-600 tracking-widest leading-none mb-1">Live in {city}</p>
                        <p className="text-3xl font-black text-slate-900 leading-tight">{Math.round(weather.temperature)}°F</p>
                        <p className="text-[10px] text-slate-500 font-black uppercase tracking-tighter">Wind: {Math.round(weather.windspeed)} mph</p>
                    </div>
                </div>
            );
        };

        const LogStream = ({ dayNum, activeUser, db, user, onUserToggle }) => {
            const [entries, setEntries] = useState([]);
            const [input, setInput] = useState("");
            const [posting, setPosting] = useState(false);

            useEffect(() => {
                if (!db || !user) return;
                const docRef = doc(db, 'artifacts', appId, 'public', 'data', 'day_logs', `day_${dayNum}`);
                const unsubscribe = onSnapshot(docRef, (docSnap) => {
                    const data = docSnap.exists() ? docSnap.data().entries : [];
                    setEntries([...data].sort((a,b) => new Date(b.timestamp) - new Date(a.timestamp)));
                }, (err) => console.error("Firestore Listen Error:", err));
                return () => unsubscribe();
            }, [dayNum, db, user]);

            const postEntry = async () => {
                if (!input.trim() || !db || !user || posting) return;
                setPosting(true);
                const entry = { 
                    user: activeUser, 
                    text: input.trim(), 
                    timestamp: new Date().toISOString(), 
                    id: crypto.randomUUID() 
                };
                const docRef = doc(db, 'artifacts', appId, 'public', 'data', 'day_logs', `day_${dayNum}`);
                try {
                    const docSnap = await getDoc(docRef);
                    if (docSnap.exists()) await updateDoc(docRef, { entries: arrayUnion(entry) });
                    else await setDoc(docRef, { entries: [entry] });
                    setInput("");
                } catch (e) { console.error("Post error:", e); }
                setPosting(false);
            };

            return (
                <div className="bg-slate-100 p-8 rounded-[3rem] flex flex-col h-[600px] border border-slate-200 shadow-inner mt-8 lg:mt-0">
                    <div className="flex justify-between items-center mb-6">
                        <h4 className="font-black text-slate-900 text-xs uppercase tracking-widest leading-none text-slate-950 font-bold">Trio Log Stream</h4>
                        <div className="flex gap-1.5">
                            {["Kevin", "Justin", "Jiwon"].map(u => (
                                <button key={u} onClick={() => onUserToggle(u)} className={`w-9 h-9 rounded-full text-[11px] font-black uppercase transition-all border ${activeUser === u ? 'bg-emerald-800 text-white border-emerald-800 shadow-md scale-110' : 'bg-white text-slate-400 border-slate-200 hover:border-slate-300'}`}>
                                    {u[0]}
                                </button>
                            ))}
                        </div>
                    </div>
                    <div className="flex-grow overflow-y-auto space-y-4 pr-1 no-scrollbar">
                        {entries.length === 0 ? (
                            <p className="text-center py-12 text-xs text-slate-400 italic">No notes yet. Be the first to post, {activeUser}!</p>
                        ) : entries.map(e => (
                            <div key={e.id} className="flex gap-4 items-start fade-in">
                                <div className={`w-10 h-10 rounded-full flex-shrink-0 flex items-center justify-center font-bold text-xs text-white shadow-sm ${e.user === 'Justin' ? 'bg-blue-500' : e.user === 'Jiwon' ? 'bg-purple-500' : 'bg-emerald-800'}`}>{e.user[0]}</div>
                                <div className="bg-white p-4 rounded-2xl rounded-tl-none border border-slate-100 shadow-sm flex-grow">
                                    <div className="flex justify-between mb-1.5">
                                        <span className="text-[10px] font-black uppercase text-slate-900 tracking-wider font-bold">{e.user}</span>
                                        <span className="text-[9px] text-slate-400 font-bold uppercase">{new Date(e.timestamp).toLocaleTimeString([], {hour:'2-digit', minute:'2-digit'})}</span>
                                    </div>
                                    <p className="text-sm text-slate-600 leading-relaxed font-medium">{e.text}</p>
                                </div>
                            </div>
                        ))}
                    </div>
                    <div className="mt-4 pt-6 border-t border-slate-200 space-y-3">
                        <textarea value={input} onChange={e => setInput(e.target.value)} placeholder={`Log as ${activeUser}...`} className="w-full p-4 bg-white border border-slate-200 rounded-2xl text-sm focus:ring-2 focus:ring-emerald-500 outline-none resize-none h-24 shadow-sm" />
                        <button 
                            disabled={!user || posting}
                            onClick={postEntry} 
                            className={`w-full font-black py-4 rounded-2xl text-[11px] uppercase tracking-widest shadow-md flex items-center justify-center gap-2 transition-all ${(!user || posting) ? 'bg-slate-300 text-slate-500 cursor-not-allowed' : 'bg-emerald-800 text-white hover:bg-emerald-700'}`}
                        >
                            {posting ? <Icon name="Loader" /> : <Icon name="Send" />}
                            {!user ? "CONNECTING..." : posting ? "POSTING..." : "POST LOG"}
                        </button>
                    </div>
                </div>
            );
        };

        const App = () => {
            const [view, setView] = useState('home');
            const [selectedDay, setSelectedDay] = useState(null);
            const [activeUser, setActiveUser] = useState(localStorage.getItem('ie_active_user') || "Kevin");
            const [user, setUser] = useState(null);
            const mapRef = useRef(null);

            useEffect(() => {
                if (firebaseConfig.apiKey) {
                    const initAuth = async () => {
                        try {
                            if (initialToken) await signInWithCustomToken(auth, initialToken);
                            else await signInAnonymously(auth);
                        } catch (err) { console.error("Auth Error:", err); }
                    };
                    initAuth().then(() => onAuthStateChanged(auth, setUser));
                }
            }, []);

            useEffect(() => {
                if (view === 'home') {
                    const L = window.L; if (!L) return;
                    const container = document.getElementById('map');
                    if (container && !mapRef.current) {
                        mapRef.current = L.map('map', { scrollWheelZoom: false, zoomControl: false }).setView([53.1, -7.8], 7);
                        L.tileLayer('https://{s}.basemaps.cartocdn.com/rastertiles/voyager/{z}/{x}/{y}{r}.png').addTo(mapRef.current);
                        ITINERARY_DATA.forEach(d => {
                            L.circleMarker(d.coords, { radius: 8, fillColor: '#059669', color: 'white', weight: 3, fillOpacity: 1 }).addTo(mapRef.current)
                             .bindPopup(`<strong>Day ${d.day}</strong>: ${d.city}`);
                        });
                        const path = ITINERARY_DATA.map(d => d.coords);
                        L.polyline(path, { color: '#059669', weight: 4, dashArray: '8, 12', opacity: 0.6 }).addTo(mapRef.current);
                    }
                } else if (mapRef.current) { mapRef.current.remove(); mapRef.current = null; }
            }, [view]);

            const changeUser = n => { setActiveUser(n); localStorage.setItem('ie_active_user', n); };

            return (
                <div className="min-h-screen flex flex-col bg-[#fcfcf9]">
                    <nav className="sticky top-0 z-[1000] bg-white/90 backdrop-blur-xl border-b border-slate-200 px-4 py-4 md:px-8 shadow-sm flex justify-between items-center text-slate-900">
                        <div onClick={() => setView('home')} className="flex items-center gap-3 cursor-pointer group">
                            <div className="w-10 h-10 bg-emerald-800 rounded-xl text-white flex items-center justify-center font-bold shadow-lg group-hover:rotate-3 transition-transform">☘️</div>
                            <span className="text-xl font-black tracking-tight text-slate-900 hidden sm:inline tracking-tighter">Cliffs, Craic <span className="text-emerald-600">& Carbs</span></span>
                            <span className="text-xl font-black tracking-tight text-emerald-600 sm:hidden uppercase tracking-widest font-black">CCC</span>
                        </div>
                        <div className="flex gap-4 items-center">
                            <div className="hidden md:flex gap-1.5 bg-slate-100 p-1 rounded-full border border-slate-200">
                                {["Kevin", "Justin", "Jiwon"].map(u => (
                                    <button key={u} onClick={() => changeUser(u)} className={`px-4 py-1.5 rounded-full text-[10px] font-black uppercase tracking-widest transition-all ${activeUser === u ? 'bg-emerald-800 text-white shadow-sm font-black' : 'text-slate-400 hover:text-slate-600'}`}>
                                        {u}
                                    </button>
                                ))}
                            </div>
                            <div className="flex gap-6 text-[11px] font-black uppercase tracking-widest text-slate-500">
                                <button onClick={() => setView('overview')} className="hover:text-emerald-700 transition-colors font-black">Strategy</button>
                                <button onClick={() => setView('itinerary')} className="hover:text-emerald-700 transition-colors font-black">Daily Logs</button>
                            </div>
                        </div>
                    </nav>

                    <main className="flex-grow max-w-7xl mx-auto w-full p-4 md:p-8">
                        {/* VIEW: HOME */}
                        {view === 'home' && (
                            <div className="fade-in space-y-12">
                                <div className="max-w-4xl">
                                    <h1 className="text-5xl md:text-8xl font-black leading-none mb-8 text-slate-900 tracking-tighter">Wild Atlantic <span className="text-emerald-700 italic serif font-normal">Expedition.</span></h1>
                                    <p className="text-xl text-slate-600 max-w-3xl leading-relaxed font-medium italic serif">
                                      Ireland is a land defined by the collision of ancient granite and the relentless Atlantic, a place where prehistoric dolmens and early Christian ruins stand as silent witnesses to a turbulent and poetic history. From the glacial valleys of the east to the karst limestone of the west, the landscape tells a story of survival, isolation, and a deep-rooted cultural spirit that thrives in the wind-swept Craic of its villages. This expedition is a traversal of that living narrative—integrating high-altitude ridges with the immersive saturation of the 2026 St. Patrick’s Festival.
                                    </p>
                                </div>
                                <div id="map" className="bg-slate-100 border-slate-200 border rounded-[2.5rem] overflow-hidden relative shadow-xl"></div>
                                
                                <div className="grid grid-cols-1 md:grid-cols-3 gap-8">
                                    <div className="bg-white p-10 rounded-[3rem] border border-slate-100 shadow-sm hover:shadow-xl transition-all">
                                        <div className="w-12 h-12 bg-blue-50 rounded-2xl flex items-center justify-center text-blue-600 mb-8 text-2xl shadow-inner font-black"><Icon name="Car" /></div>
                                        <h3 className="text-xl font-black text-slate-900 mb-3 uppercase tracking-tighter">Multimodal Loop</h3>
                                        <p className="text-sm text-slate-500 font-bold leading-relaxed">Rural private rental vehicle autonomy for the rugged coast; transition to pedestrian modes for the Dublin festival phase.</p>
                                    </div>
                                    <div className="bg-white p-10 rounded-[3rem] border border-slate-100 shadow-sm hover:shadow-xl transition-all">
                                        <div className="w-12 h-12 bg-emerald-50 rounded-2xl flex items-center justify-center text-emerald-600 mb-8 text-2xl shadow-inner font-black"><Icon name="Zap" /></div>
                                        <h3 className="text-xl font-black text-slate-900 mb-3 uppercase tracking-tighter">Alpine Resilience</h3>
                                        <p className="text-sm text-slate-500 font-bold leading-relaxed">High-altitude framework integrating Glendalough and Mt. Brandon (952m) summiting with strict gear protocols.</p>
                                    </div>
                                    <div className="bg-white p-10 rounded-[3rem] border border-slate-100 shadow-sm hover:shadow-xl transition-all">
                                        <div className="w-12 h-12 bg-amber-50 rounded-2xl flex items-center justify-center text-amber-600 mb-8 text-2xl shadow-inner font-black"><Icon name="Calendar" /></div>
                                        <h3 className="text-xl font-black text-slate-900 mb-3 uppercase tracking-tighter">Festival Quarter</h3>
                                        <p className="text-sm text-slate-500 font-bold leading-relaxed">Strategic return to Dublin by Mar 14th for Collins Barracks and the Guinness Storehouse Taste Mór hubs.</p>
                                    </div>
                                </div>
                            </div>
                        )}

                        {/* VIEW: STRATEGIC ANALYSIS */}
                        {view === 'overview' && (
                            <div className="fade-in space-y-12 pb-24 prose-analysis">
                                <header className="border-b border-slate-200 pb-10">
                                    <h2 className="text-4xl md:text-6xl font-black text-slate-900 italic serif leading-tight tracking-tight">Strategic Framework & Analysis</h2>
                                    <p className="text-emerald-700 font-black uppercase tracking-[0.2em] text-[11px] mt-4 leading-relaxed max-w-2xl font-black">Analysis and 10-Day Expeditionary Framework for the 2026 St. Patrick’s Circuit</p>
                                </header>
                                <div className="grid grid-cols-1 lg:grid-cols-12 gap-16">
                                    <div className="lg:col-span-8 space-y-12">
                                        <section>
                                          <h3>Ireland: Identity & The People</h3>
                                          <p>Modern Ireland is a land of profound dualities. Known globally for its contributions to literature (Joyce, Yeats, Heaney) and its world-class whiskey and brewing traditions, its true character lies in the concept of <strong>"The Craic"</strong>—a unique blend of hospitality, witty conversation, and shared entertainment. The Irish people are renowned masters of storytelling, possessed of a laid-back resilience that values community over rigid structures.</p>
                                        </section>

                                        <section>
                                          <h3>Cultural Experiences & Gastronomy</h3>
                                          <p>To truly engage with the island, prioritize the local "nodes" of culture. Evening **Trad Sessions** in rural pubs (Dingle/Galway), witnessing a high-speed **Hurling match**, and visiting the **Gaeltacht areas** where Gaeilge (Irish) is the daily tongue. Culinary highlights for this trip include:</p>
                                          <ul className="list-disc pl-6 space-y-4 text-slate-600 font-medium font-bold">
                                            <li><strong>Spiced Beef:</strong> A rare Cork delicacy from the English Market.</li>
                                            <li><strong>Boxty & Colcannon:</strong> Traditional potato-based dishes that define regional identity.</li>
                                            <li><strong>Catch-to-Table Seafood:</strong> Focus on Dingle bay lobster and Clarenbridge oysters.</li>
                                            <li><strong>Artisan Soda Bread:</strong> A staple found in every high-end roastery or farm-to-fork cafe.</li>
                                          </ul>
                                        </section>

                                        <section>
                                          <h3>Linguistic Protocol: Common Phrases</h3>
                                          <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                                            <div className="p-5 bg-white border rounded-2xl shadow-sm italic text-sm font-bold">"What's the Craic?" (How's it going? / What's the news?)</div>
                                            <div className="p-5 bg-white border rounded-2xl shadow-sm italic text-sm font-bold">"Sláinte" (Cheers / Good Health - Essential for the pub)</div>
                                            <div className="p-5 bg-white border rounded-2xl shadow-sm italic text-sm font-bold">"Grand" (The most versatile word: Fine / Great / Okay)</div>
                                            <div className="p-5 bg-white border rounded-2xl shadow-sm italic text-sm font-bold">"Deadly" (Excellent / Brilliant)</div>
                                          </div>
                                        </section>

                                        <section>
                                          <h3>Rules of the Road: Tactical Driving</h3>
                                          <p>Driving in Ireland, particularly on the Wild Atlantic Way, requires specific tactical awareness:</p>
                                          <ul className="list-disc pl-6 space-y-4 text-slate-600 font-medium font-bold italic">
                                            <li><strong>Left-Hand Operation:</strong> All movement occurs on the left. Yield to the right at all roundabouts.</li>
                                            <li><strong>Boreens:</strong> Extremely narrow rural roads. Be prepared to reverse to a passing place.</li>
                                            <li><strong>Livestock Right-of-Way:</strong> Sheep and cattle always possess the right of way.</li>
                                            <li><strong>Zero Tolerance:</strong> Strict drink-driving laws; avoid consumption if operating a vehicle.</li>
                                          </ul>
                                        </section>

                                        <section>
                                          <h3>National Festival Infrastructure (Mar 14-17)</h3>
                                          <p>The 2026 circuit culminates at the **Festival Quarter (Collins Barracks)** and **Guinness Storehouse (Taste Mór)**. Note: Tara Street Station will be closed until 16:00 on March 17 for the National Parade.</p>
                                        </section>
                                    </div>

                                    {/* RESILIENCE VITALS (IDS & WHITE TEXT FIXED) */}
                                    <div className="lg:col-span-4 space-y-8">
                                        <div id="vitalinfo" className="bg-slate-900 p-12 rounded-[3.5rem] shadow-2xl space-y-12 border border-slate-800 text-white">
                                            <h3 id="rv-header" className="text-3xl font-black border-none p-0 m-0 tracking-tight leading-none text-white font-bold">Resilience Vitals</h3>
                                            <div className="space-y-10 text-white">
                                                <div className="flex gap-6 items-center">
                                                  <div className="w-16 h-16 bg-emerald-800 rounded-3xl flex items-center justify-center shrink-0 shadow-lg text-white border border-emerald-700 font-bold">
                                                    <Icon name="Wind" className="w-8 h-8 text-emerald-400 font-bold" />
                                                  </div>
                                                  <div>
                                                    <h5 className="text-[12px] font-black uppercase text-emerald-400 mb-2 tracking-[0.2em] leading-none font-bold">Safety Threshold</h5>
                                                    <p id="rv-stats" className="text-xl text-white font-black italic tracking-tight leading-none">60 mph peak ridges</p>
                                                  </div>
                                                </div>
                                                <div className="pt-10 border-t border-slate-800">
                                                    <h5 id="rv-protocol-label" className="text-[11px] font-black uppercase text-emerald-400 text-center mb-10 tracking-[0.3em] font-bold">3-Layer Gear Protocol</h5>
                                                    <div className="grid grid-cols-3 gap-2 text-center text-[10px] font-black uppercase tracking-widest text-white">
                                                        <div className="space-y-4">
                                                            <div className="w-12 h-12 bg-emerald-600 rounded-full mx-auto flex items-center justify-center border-2 border-emerald-400 shadow-2xl text-xl text-white font-black">1</div>
                                                            <span className="text-white font-black uppercase">Base</span>
                                                        </div>
                                                        <div className="space-y-4">
                                                            <div className="w-12 h-12 bg-emerald-600 rounded-full mx-auto flex items-center justify-center border-2 border-emerald-400 shadow-2xl text-xl text-white font-black">2</div>
                                                            <span className="text-white font-black uppercase">Mid</span>
                                                        </div>
                                                        <div className="space-y-4">
                                                            <div className="w-12 h-12 bg-emerald-600 rounded-full mx-auto flex items-center justify-center border-2 border-emerald-400 shadow-2xl text-xl text-white font-black">3</div>
                                                            <span className="text-white font-black uppercase">Shell</span>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        )}

                        {/* VIEW: LOGS LIST */}
                        {view === 'itinerary' && (
                            <div className="fade-in space-y-12 pb-24 text-center">
                                <h2 className="text-4xl md:text-5xl font-black text-slate-900 italic serif tracking-tighter uppercase">Expedition Logs</h2>
                                <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8 text-left">
                                    {ITINERARY_DATA.map((d, i) => (
                                        <div key={i} onClick={() => { setSelectedDay(i); setView('day-detail'); }} className="blog-card bg-white rounded-[3rem] overflow-hidden shadow-sm border border-slate-100">
                                            <div className="h-60 relative overflow-hidden">
                                                <img src={d.img} alt={d.city} className="w-full h-full object-cover transition-transform duration-700 hover:scale-105" />
                                                <div className="absolute top-6 left-6 bg-white/90 backdrop-blur px-4 py-2 rounded-full text-[10px] font-black tracking-widest uppercase shadow-sm font-bold font-bold">Day {d.day}</div>
                                            </div>
                                            <div className="p-8">
                                                <h3 className="text-2xl font-bold text-slate-900 leading-tight mb-2 tracking-tight">{d.title}</h3>
                                                <div className="flex items-center gap-2 text-[10px] text-emerald-600 font-black uppercase tracking-widest mb-4 leading-none font-bold">
                                                    <Icon name="MapPin" className="w-3 h-3" /> {d.city}
                                                </div>
                                                <p className="text-sm text-slate-500 line-clamp-2 leading-relaxed font-bold">{d.desc}</p>
                                            </div>
                                        </div>
                                    ))}
                                </div>
                            </div>
                        )}

                        {/* VIEW: DAY DETAIL */}
                        {view === 'day-detail' && selectedDay !== null && (
                            <div className="fade-in pb-24">
                                <button onClick={() => setView('itinerary')} className="mb-10 font-black text-emerald-800 text-[11px] tracking-widest uppercase flex items-center gap-3 hover:translate-x-[-5px] transition-all font-black">
                                    <div className="w-8 h-8 rounded-full border-2 border-emerald-800 flex items-center justify-center transition-all shadow-sm font-black"><Icon name="ArrowLeft" /></div> BACK TO LOGS
                                </button>
                                <header className="detail-header relative h-[65vh] rounded-[3.5rem] md:rounded-[4.5rem] overflow-hidden shadow-2xl mb-16 border-4 border-white shadow-emerald-900/10 bg-slate-200">
                                    <img src={ITINERARY_DATA[selectedDay].img} className="w-full h-full object-cover" />
                                    <div className="absolute inset-0 bg-gradient-to-t from-black/90 via-black/30 to-transparent"></div>
                                    <div className="absolute bottom-12 left-8 md:left-16 right-8 md:right-16 text-white">
                                        <span className="text-[11px] font-black uppercase bg-emerald-600 px-5 py-2 rounded-full mb-6 inline-block tracking-[0.4em] shadow-lg shadow-emerald-950/20 font-bold">Expedition Phase {ITINERARY_DATA[selectedDay].day}</span>
                                        <h2 className="hero-title text-4xl sm:text-6xl md:text-8xl font-black mb-6 leading-tight tracking-tighter">{ITINERARY_DATA[selectedDay].title}</h2>
                                        <div className="flex flex-wrap items-center gap-8 text-lg sm:text-3xl serif italic opacity-95 tracking-tight">
                                            <span className="flex items-center gap-3 font-bold font-bold"><Icon name="MapPin" className="w-7 h-7 text-emerald-400" /> {ITINERARY_DATA[selectedDay].city}</span>
                                            <span className="flex items-center gap-3 font-bold font-bold"><Icon name="Calendar" className="w-7 h-7 text-emerald-400" /> {ITINERARY_DATA[selectedDay].date}</span>
                                        </div>
                                    </div>
                                </header>
                                <div className="grid grid-cols-1 lg:grid-cols-3 gap-12 text-slate-900 font-bold">
                                    <div className="lg:col-span-2 space-y-16">
                                        <div className="grid grid-cols-1 md:grid-cols-2 gap-8 items-stretch">
                                            <WeatherTile city={ITINERARY_DATA[selectedDay].city} coords={ITINERARY_DATA[selectedDay].coords} />
                                            <div className="reddit-quote font-black text-base leading-relaxed italic border-emerald-200 shadow-sm">
                                                <p className="text-[10px] font-black uppercase text-[#ff4500] tracking-[0.2em] mb-3 leading-none flex items-center gap-2 font-black font-bold">Community Insights</p>
                                                "{ITINERARY_DATA[selectedDay].reddit}"
                                            </div>
                                        </div>

                                        <section className="grid grid-cols-1 md:grid-cols-2 gap-8">
                                            <div className="research-pill"><h5 className="text-[10px] font-black uppercase text-emerald-600 mb-2 leading-none font-bold font-bold">Cool Shop</h5><h6 className="font-bold text-slate-900 text-xl tracking-tight mb-2 leading-tight">{ITINERARY_DATA[selectedDay].hiddenShop}</h6><p className="text-sm text-slate-500 font-bold font-bold leading-relaxed">{ITINERARY_DATA[selectedDay].shopDesc}</p></div>
                                            <div className="research-pill"><h5 className="text-[10px] font-black uppercase text-emerald-600 mb-2 leading-none font-bold font-bold">Heritage</h5><h6 className="font-bold text-slate-900 text-xl tracking-tight mb-2 leading-tight">{ITINERARY_DATA[selectedDay].hiddenBuilding}</h6><p className="text-sm text-slate-500 font-bold font-bold leading-relaxed">{ITINERARY_DATA[selectedDay].buildingDesc}</p></div>
                                        </section>

                                        <section className="bg-emerald-900 text-white p-12 rounded-[4rem] shadow-2xl relative overflow-hidden">
                                            <div className="flex flex-col md:flex-row justify-between items-start md:items-center border-b border-emerald-800 pb-10 gap-6">
                                              <div>
                                                <h3 className="text-4xl font-black mb-1 tracking-tight text-white">{ITINERARY_DATA[selectedDay].hike}</h3>
                                                <p className="text-emerald-400 text-[11px] font-black uppercase tracking-[0.3em] leading-none font-bold font-bold">Priority Objective</p>
                                              </div>
                                              {ITINERARY_DATA[selectedDay].hikeLink !== '#' && (<a href={ITINERARY_DATA[selectedDay].hikeLink} target="_blank" className="bg-white text-emerald-900 px-10 py-4 rounded-2xl text-[11px] font-black uppercase shadow-2xl hover:bg-emerald-50 transition-all font-bold font-bold">AllTrails Intel</a>)}
                                            </div>
                                            <p className="text-2xl opacity-90 italic serif leading-relaxed text-emerald-50 mt-10">"{ITINERARY_DATA[selectedDay].desc}"</p>
                                        </section>
                                    </div>
                                    <div className="space-y-8 font-black font-black">
                                        <div className="bg-white p-10 rounded-[2.5rem] border border-slate-100 shadow-sm space-y-4 font-bold">
                                            <h4 className="font-black text-slate-900 uppercase text-[10px] tracking-widest border-b pb-4 flex items-center gap-3 tracking-tighter leading-none font-bold"><Icon name="Info" className="text-emerald-600 font-bold" /> Expedition Brief</h4>
                                            <p className="text-[10px] text-slate-400 font-black uppercase tracking-tighter mb-1 leading-none font-bold">Est. Daily Budget</p>
                                            <p className="text-xl font-black text-slate-900 tracking-tight leading-none italic font-bold">{ITINERARY_DATA[selectedDay].cost}</p>
                                        </div>
                                        <LogStream dayNum={ITINERARY_DATA[selectedDay].day} activeUser={activeUser} db={db} user={user} onUserToggle={changeUser} />
                                    </div>
                                </div>
                            </div>
                        )}
                    </main>
                    <footer className="mt-24 border-t border-slate-100 py-20 px-8 text-center text-slate-400 text-[11px] font-black uppercase tracking-[0.6em] font-bold">&copy; 2026 Cliffs, Craic & Carbs Trio Expedition</footer>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
